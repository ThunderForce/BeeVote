<!DOCTYPE HTML>
<html>

	<head>

		<title>Proposal - BeeVote</title>
		
		{{ basic_head }}

		<script src="/static/js/vote-functions.js"></script>
		
		<script>
			$(document).ready(function() {
				$("#vote_list_button").on("click", function() {
					if ($(this).attr("aria-expanded") != "true") {
						$("#list_of_votes").html("<li>Loading...</li>");
						var success_callback = function(response) {
							$("#list_of_votes").html("");
							$.each(response.votes, function(index, vote) {
								$("#list_of_votes").append("<li>"+vote.name+" "+vote.surname+"</li>");
							});
						}
						load_votes("{{ proposal.parent.parent.key.id }}", "{{ proposal.parent.key.id }}", "{{ proposal.key.id }}", success_callback);
					}
					
				});
			});
			function toggle_vote(group, topic, proposal) {
				$("#number_of_votes").html("...");
				success_callback = function(response) {
					$("#number_of_votes").html(response.vote_number);
				};
				if ($("#vote").is(":checked"))
					add_vote(group, topic, proposal, success_callback);
				else
					remove_vote(group, topic, proposal, success_callback);
			}
		</script>

	</head>

	<body>

		{{ navbar }}

		<div class="jumbotron" style="max-width:900px;">
			<div class="jumbotron" style="max-width:900px;">
				<div class="row">
					<div class="col-lg-5">
						<h1>{{ proposal.title }}</h1>
						<p>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProposed by <a href="javascript:void(0)" class="btn btn-flat btn-info">{{proposal.creator.name}} {{proposal.creator.surname}}</a></p>
					</div>
					<div class="col-lg-3"></div>
					<div class="col-lg-3">
								<div class="btn-group">
									<a class="btn btn-info dropdown-toggle" data-toggle="dropdown" id="vote_list_button">Votes&nbsp&nbsp&nbsp
										<span class="badge" id="number_of_votes">{{ vote_number }}</span>&nbsp&nbsp<span class="caret"></span></a>
									<ul class="dropdown-menu" id="list_of_votes">
										<!-- Here there's a dynamic list of votes -->
									</ul>
								</div>
					</div>
					<div class="col-lg-1">
						{% if not proposal.parent.expired %}
						<span class="label label-info">Vote</span><span class="row-action-primary checkbox"><label><input id="vote" type="checkbox" onClick='javascript:toggle_vote("{{ proposal.parent.parent.key.id }}", "{{ proposal.parent.key.id }}", "{{ proposal.key.id }}");' {% if already_voted %}checked {% endif %}></label></span>
						{% else %}
						<span class="row-action-primary checkbox disabled" title="You cannot change your vote because the topic has reached its deadline."><label><input type="checkbox" {% if already_voted %}checked {% endif %} disabled></label></span>
						{% endif %}
					</div>
				</div>
			</div>

			<div class ="row">
				<div class ="col-lg-6">	
					<div class="well">
						Date: {{ proposal.date }}
					</div>
				</div>
				<div class="col-lg-6">
					<div class="well">
						Time: {{ proposal.time }}
					</div>
				</div>
			</div>

			<div class="panel panel-default">
				<div class="panel-heading"><h2>{{ proposal.place }}</h2></div>
				<div class="panel-body">
					<p>Place description.</p>
					<p>Address: ADDRESS</p>
					<p><a class="btn btn-info btn-lg">View on Google Maps</a></p>
				</div>
			</div>

			<div class="panel panel-default">
				<div class="panel-heading">Description</div>
				<div class="panel-body">{{ proposal.description }}</div>
			</div>
		</div>

	</body>
</html>